<!DOCTYPE html>

<html>
<head>
  <title>ObjLoader</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          
          <h1 id="objloader">ObjLoader</h1>

          
        

        
          <div class="toc">
            <h3>Table of Contents</h3>
            <ol>
              
                
                <li>
                  <a class="source" href="app.html">
                    app.litcoffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="gl.html">
                    gl.litcoffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="mesh.html">
                    mesh.litcoffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="objloader.html">
                    objloader.litcoffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="user.html">
                    user.litcoffee
                  </a>
                </li>
              
            </ol>
          </div>
        
      </div>

      
        
        <h2 id="objloader">ObjLoader</h2>
<p>The ObjLoader takes a string and parses it as a WaveFront .obj-file. It will create a list of vertices, a list of
normals, a list of texels and a list of faces. Those can then be used to create a mesh for WebGL.</p>

        
          <div class='highlight'><pre><span class="hljs-built_in">module</span>.<span class="hljs-built_in">exports</span> = <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ObjLoader</span></span></pre></div>
        
      
        
        <h3 id="constructor">constructor</h3>
<p>The constructor will start the parsing immediately. Splitting this into constructor and parser might be better if the
loader should later be able to be used asynchronously but this works for now.<br><strong>WARNING</strong> Only a subset of the specification is supported at the moment and there is no proper handling of
unsupported lines.</p>

        
          <div class='highlight'><pre>	<span class="hljs-attribute">constructor</span>:<span class="hljs-function"> -&gt;</span>
		<span class="hljs-property">@vertices</span> = []
		<span class="hljs-property">@normals</span> = []
		<span class="hljs-property">@texels</span> = []
		<span class="hljs-property">@faces</span> = []</pre></div>
        
      
        
        <h3 id="parse">parse</h3>
<p>The parsing is as simple as splitting the file into it’s lines and after that parse them one by one. If the line begins
with a <code>#</code> then it’s a comment and will be ignored. The line is then split on every whitespace and because of the way
JavaScript objects are composed the first token can be used as the method name to call, passing in the rest of the
tokens as parameters.</p>

        
          <div class='highlight'><pre>	<span class="hljs-attribute">parse</span>: <span class="hljs-function"><span class="hljs-params">( objData )</span> -&gt;</span>
		<span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> objData.split <span class="hljs-string">'\n'</span>
			<span class="hljs-keyword">continue</span> <span class="hljs-keyword">if</span> ( line.charAt <span class="hljs-number">0</span> ) == <span class="hljs-string">'#'</span>
			tokens = line.trim().split <span class="hljs-regexp">/\s+/</span>
			@[tokens[<span class="hljs-number">0</span>]].apply @, tokens[<span class="hljs-number">1.</span>.]</pre></div>
        
      
        
        <h3 id="v">v</h3>
<p>A vertex is created from three components, <code>x, y, z</code>. The .obj specification allows for a fourth <code>w</code> component which is
ignored here. All components are parsed as floats.</p>

        
          <div class='highlight'><pre>	<span class="hljs-attribute">v</span>: <span class="hljs-function"><span class="hljs-params">( x, y, z )</span> -&gt;</span>
		<span class="hljs-property">@vertices</span>.push [
			parseFloat x
			parseFloat y
			parseFloat z
		]</pre></div>
        
      
        
        <h3 id="vn">vn</h3>
<p>A normal is created from three components, <code>i, j, k</code>. All components are parsed as floats.</p>

        
          <div class='highlight'><pre>	<span class="hljs-attribute">vn</span>: <span class="hljs-function"><span class="hljs-params">( i, j, k )</span> -&gt;</span>
		<span class="hljs-property">@normals</span>.push [
			parseFloat i
			parseFloat j
			parseFloat k
		]</pre></div>
        
      
        
        <h3 id="vt">vt</h3>
<p>A texel, texture coordinate, is created from two components. The .obj specification allows for a third <code>w</code> component
which is ignored here. All components are parsed as floats.</p>

        
          <div class='highlight'><pre>	<span class="hljs-attribute">vt</span>: <span class="hljs-function"><span class="hljs-params">( u, v )</span> -&gt;</span>
		<span class="hljs-property">@texels</span>.push [
			parseFloat u
			parseFloat v
		]</pre></div>
        
      
        
        <h3 id="f">f</h3>
<p>Faces are groups of indices corresponding to the vertices.<br><strong>IMPORTANT</strong> Support for v/vt/vn must be added. I have to look at how index lists for texels and normals looks like in
WebGL to do this properly but I think I remember that usually the vertex is expanded with the extra data. Something
like [x, y, z, u, v] for a textured vertex.<br><strong>WARNING</strong> There is no support for negative indices at the moment.</p>

        
          <div class='highlight'><pre>	<span class="hljs-attribute">f</span>: <span class="hljs-function"><span class="hljs-params">( indices... )</span> -&gt;</span>
		<span class="hljs-keyword">for</span> currentIndex <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..indices.length]
			indices[currentIndex] = parseFloat indices[currentIndex]
		<span class="hljs-property">@faces</span>.push indices</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
