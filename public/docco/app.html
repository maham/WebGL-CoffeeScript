<!DOCTYPE html>

<html>
<head>
  <title>App</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="app.html">
                app.litcoffee
              </a>
            
              
              <a class="source" href="camera.html">
                camera.litcoffee
              </a>
            
              
              <a class="source" href="gl.html">
                gl.litcoffee
              </a>
            
              
              <a class="source" href="glmath.html">
                glmath.litcoffee
              </a>
            
              
              <a class="source" href="loader.html">
                loader.litcoffee
              </a>
            
              
              <a class="source" href="mesh.html">
                mesh.litcoffee
              </a>
            
              
              <a class="source" href="metronome.html">
                metronome.litcoffee
              </a>
            
              
              <a class="source" href="microevent.html">
                microevent.litcoffee
              </a>
            
              
              <a class="source" href="objparser.html">
                objparser.litcoffee
              </a>
            
              
              <a class="source" href="time.html">
                time.litcoffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="app">App</h1>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>This app is my playground for learning both <a href="http://www.coffeescript.org">CoffeeScript</a> and
<a href="http://khronos.org/webgl">WebGL</a>. Anything you find here is used at your own risk. As you can see all the code is
available right here on the site you are reading so feel free to have a look around.</p>
<h2 id="dependencies">Dependencies</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>We have a couple of external classes to get the app running. We need <a href="gl.html" title="Utility class for WebGL">GL</a> to handle
the WebGL related tasks. And we will need <a href="time.html" title="High performance timer functions">time</a> for the game loop timer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>GL = <span class="hljs-built_in">require</span> <span class="hljs-string">'app/gl'</span>
Metronome = <span class="hljs-built_in">require</span> <span class="hljs-string">'app/metronome'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="start-the-application">Start the application</h2>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>The app must wait for everything to be properly loaded before it can start. This is done with a simple event listener
waiting for the <code>DOMContentLoaded</code> event. There is a lot of JS-frameworks that could help with this but at the moment
this method will be sufficient.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">document</span>.addEventListener <span class="hljs-string">"DOMContentLoaded"</span>,<span class="hljs-function"> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>The shaders are loaded asynchronously as text. Pre-compiled shaders don’t exist in WebGL yet and it’s probably not high
on the list as it would be a security concern as far as I understand it. So let’s create a couple of variables store
the shader code in until we are ready init GL.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	fragmentShaderSource	=
	vertexShaderSource		=
	cubeData				= <span class="hljs-literal">undefined</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Now it’s time to start the asynchronous loading of the shaders. Store the shader code when the ajax request is done.
As there is two shaders that are both loaded async the app must wait until both are loaded before continuing execution
of the app.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-built_in">console</span>.log <span class="hljs-string">'Starting to load shaders.'</span>
	<span class="hljs-keyword">new</span> microAjax <span class="hljs-string">'./fShader.frag'</span>, <span class="hljs-function"><span class="hljs-params">( resource )</span> -&gt;</span>
		<span class="hljs-built_in">console</span>.log <span class="hljs-string">'Fragment shader loaded.'</span>
		fragmentShaderSource = resource

	<span class="hljs-keyword">new</span> microAjax <span class="hljs-string">'./vShader.vert'</span>, <span class="hljs-function"><span class="hljs-params">( resource )</span> -&gt;</span>
		<span class="hljs-built_in">console</span>.log <span class="hljs-string">'Vertex shader loaded.'</span>
		vertexShaderSource = resource

	<span class="hljs-keyword">new</span> microAjax <span class="hljs-string">'./capsule.obj'</span>, <span class="hljs-function"><span class="hljs-params">( resource )</span> -&gt;</span>
		<span class="hljs-built_in">console</span>.log <span class="hljs-string">'Cube data loaded.'</span>
		cubeData = resource</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h4 id="waitforassets">waitForAssets</h4>
<p>This method does exactly what is says. It waits for the assets to load in one second loops and when all assets are done
loading it will call <a href="#startgl"><code>startGL</code></a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-function"><span class="hljs-title">waitForAssets</span> = -&gt;</span>
		setTimeout<span class="hljs-function"> -&gt;</span>
			<span class="hljs-keyword">if</span> fragmentShaderSource? <span class="hljs-keyword">and</span> vertexShaderSource? <span class="hljs-keyword">and</span> cubeData?
				startGL <span class="hljs-string">'lesson01-canvas'</span>, fragmentShaderSource, vertexShaderSource
			<span class="hljs-keyword">else</span>
				waitForAssets()
		, <span class="hljs-number">1000</span>

	waitForAssets()</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>We need another couple of globals to store the mesh we are going to draw, and to store the gl object that will take
care of the 3D rendering.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	gl = <span class="hljs-literal">null</span>
	cube = <span class="hljs-literal">null</span>
	metronome = <span class="hljs-keyword">new</span> Metronome <span class="hljs-number">60</span>
	metronome.<span class="hljs-literal">on</span> <span class="hljs-string">"Tick"</span>,<span class="hljs-function"> -&gt;</span>
		gl.tick()
		gl.drawScene [cube]
		<span class="hljs-keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h3 id="startgl">startGL</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-function"><span class="hljs-title">startGL</span> = <span class="hljs-params">( canvasElementId, fragmentShaderSource, vertexShaderSource )</span> -&gt;</span>
		gl = <span class="hljs-keyword">new</span> GL canvasElementId</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>After GL is initialized the shader program have to be compiled and linked.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		shader = gl.createShaderProgram fragmentShaderSource, vertexShaderSource
		gl.setShader shader

		cube = gl.createMeshFromObj cubeData

		metronome.start()
, <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
